alias: beok_align_currenttemp
description: ""
triggers:
  - trigger: numeric_state
    entity_id:
      - climate.beok_thermostat
    for:
      hours: 0
      minutes: 0
      seconds: 5
    attribute: current_temperature
    above: sensor.desk_temperature
  - trigger: numeric_state
    entity_id:
      - climate.beok_thermostat
    for:
      hours: 0
      minutes: 0
      seconds: 5
    attribute: current_temperature
    below: sensor.desk_temperature
conditions:
  - condition: template
    value_template: >-
      {{ (states('sensor.desk_temperature') | float -
      (state_attr('climate.beok_thermostat','current_temperature') | float) ) |
      abs > 0.1 }}
actions:
  - target:
      entity_id: input_number.beok_offset
    data:
      value: >-
        {{ ((states('number.beok_thermostat_local_temperature_calibration') |
        float) + (states('sensor.desk_temperature') | float) -
        (state_attr('climate.beok_thermostat','current_temperature') | float)) |
        round(1) }}
    action: input_number.set_value
  - wait_template: "{{ false }}"
    timeout: "00:00:02"
  - action: number.set_value
    metadata: {}
    target:
      entity_id: number.beok_thermostat_local_temperature_calibration
    data:
      value: "{{ states('input_number.beok_offset') | float | round(1) }}"
mode: single
